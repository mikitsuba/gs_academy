<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width">
<script src="js/jquery-2.1.3.min.js"></script>
<link rel="stylesheet" href="css/sample.css">
<title>じゃんけん & 30ゲーム</title>
</head>
<body>

<header>
  <h1 class="janken-title">じゃんけん & 30ゲーム</h1>
</header>

<main>
  <section id="janken">
    <div class="wrapper janken-wrapper">
      <h2 class="small-title">じゃんけん</h2>
      <ul>
        <li id="rock_btn">グー</li>
        <li id="scissors_btn">チョキ</li>
        <li id="paper_btn">パー</li>
      </ul>
      <div class="janken-result">
        <div>コンピュータの出した手は？「<span id="pc_hands">なに？</span>」</div>
        <div>勝敗結果は・・・<span id="judgment"></span></div>
      </div>
    </div>
  </section>

  <section id="30-game">
    <div class="wrapper 30-game-wrapper">
      <h2 class="small-title">30ゲーム</h2>
      <div class="mode-select">
        <span class="easy-mode" id="easy-mode">イージー</span>
        <span class="hard-mode" id="hard-mode">ハード</span>
      </div>
      <div class="balloon-container">
        <div class="balloon-instruction">
          <p class="instruction" id="turn-message">1ターンに3つまで数字を選んで、<span>OK!</span>を押してね！</p>
        </div>
      </div>
      <div class="turn-box">
        <p class="turn"><span id="turn"></span>の番</p>
        <span id="ok-btn">OK!</span>
      </div>
      <table class="numbers">
        <tr>
          <td class="number" id="number1">1</td>
          <td class="number" id="number2">2</td>
          <td class="number" id="number3">3</td>
          <td class="number" id="number4">4</td>
          <td class="number" id="number5">5</td>
          <td class="number" id="number6">6</td>
          <td class="number" id="number7">7</td>
          <td class="number" id="number8">8</td>
          <td class="number" id="number9">9</td>
          <td class="number" id="number10">10</td>
        </tr>
        <tr>
          <td class="number" id="number11">11</td>
          <td class="number" id="number12">12</td>
          <td class="number" id="number13">13</td>
          <td class="number" id="number14">14</td>
          <td class="number" id="number15">15</td>
          <td class="number" id="number16">16</td>
          <td class="number" id="number17">17</td>
          <td class="number" id="number18">18</td>
          <td class="number" id="number19">19</td>
          <td class="number" id="number20">20</td>
        </tr>
        <tr>
          <td class="number" id="number21">21</td>
          <td class="number" id="number22">22</td>
          <td class="number" id="number23">23</td>
          <td class="number" id="number24">24</td>
          <td class="number" id="number25">25</td>
          <td class="number" id="number26">26</td>
          <td class="number" id="number27">27</td>
          <td class="number" id="number28">28</td>
          <td class="number" id="number29">29</td>
          <td class="number" id="number30">30</td>
        </tr>
      </table>
      <div class="result-box">
        <p class="result" id="result"></p>
        <span class="result" id="play-again"></span>
      </div>
    </div>
  </section>

</main>

<footer></footer>
<script>

//じゃんけん用のSCRIPT
  let pc_hands = '';
  let user_hands = '';

  function pc_hand_roulette(){
    const rand_num = Math.ceil(Math.random() * 3);
    if(rand_num == 1){
      pc_hands = 'グー！';
    } else if(rand_num == 2){
      pc_hands = 'チョキ！';
    } else {
      pc_hands = 'パー！';
    }
    $('#pc_hands').text(pc_hands);
  }

  function janken_judgment(){
    if(pc_hands == user_hands){
      $('#judgment').text('あいこ！（もう1回出す手を選んで）');
    } else if (pc_hands == 'グー！' && user_hands == 'チョキ！'){
      $('#judgment').text('あなたの負け！');
    } else if (pc_hands == 'グー！' && user_hands == 'パー！'){
      $('#judgment').text('あなたの勝ち！');
    } else if (pc_hands == 'チョキ！' && user_hands == 'パー！'){
      $('#judgment').text('あなたの負け！');
    } else if (pc_hands == 'チョキ！' && user_hands == 'グー！'){
      $('#judgment').text('あなたの勝ち！');
    } else if (pc_hands == 'パー！' && user_hands == 'グー！'){
      $('#judgment').text('あなたの負け！');
    } else if (pc_hands == 'パー！' && user_hands == 'チョキ！'){
      $('#judgment').text('あなたの勝ち！');
    }
  }

  // グーをクリックした場合
  $('#rock_btn').on('click', function(){
    user_hands = 'グー！'
    pc_hand_roulette();
    janken_judgment();
  })

  // チョキをクリックした場合
  $('#scissors_btn').on('click', function(){
    user_hands = 'チョキ！'
    pc_hand_roulette();
    janken_judgment();
  })

  // パーをクリックした場合
  $('#paper_btn').on('click', function(){
    user_hands = 'パー！'
    pc_hand_roulette();
    janken_judgment();
  })


// 30ゲーム用のscript
// 難易度の選択
// デフォルトはイージーモード
let difficulty = 'easy';
$('#easy-mode').on('click', function(){
  difficulty = 'easy';
  $('#hard-mode').css('background-color', 'white');
  $('#hard-mode').css('color', 'black');
  $('#easy-mode').css('background-color', 'navy');
  $('#easy-mode').css('color', 'white');
})

$('#hard-mode').on('click', function(){
  difficulty = 'hard';
  $('#easy-mode').css('background-color', 'white');
  $('#easy-mode').css('color', 'black');
  $('#hard-mode').css('background-color', 'navy');
  $('#hard-mode').css('color', 'white');
})

//ターンの表示
let player_turn = true; // ターンを定義。trueがplayerでfalseがcom
function turn_change(){
  if(player_turn){
    $('#turn').text('あなた');
    $('#ok-btn').show();
  } else {
    $('#turn').text('COM');
    $('#ok-btn').hide();
  }
}

// 選択された数字の状態を変える関数
let button_status_array = ['open', 'open', 'open', 'open', 'open', 'open', 'open', 'open', 'open', 'open', 'open', 'open', 'open', 'open', 'open', 'open', 'open', 'open', 'open', 'open', 'open', 'open', 'open', 'open', 'open', 'open', 'open', 'open', 'open', 'open']; //選択された数字の状態
function statusChanger(button_num){
  // playerのターン
  if(player_turn){
    // そのターンに選択されたボタンの場合、もとに戻す
    if(button_status_array[button_num - 1] == 'tentative'){
      button_status_array[button_num - 1] == 'open';
    }else if(button_status_array[button_num - 1] == 'open' && (button_num <= 3 || ['player', 'com'].includes(button_status_array[button_num - 4]))){
      button_status_array[button_num - 1] == 'tentative';
    }else if(['player', 'com'].includes(button_status_array[button_num - 1])){
      alert('その数字は選択済みです');
    }else{
      alert('選択済みの数字に続く3つ以内の数字を選択してください');
    }
  }
  // comのターン
  else{
    button_status_array[button_num - 1] == 'com';
  }
}

// comが選択する数字を決める関数
function comSelector(){
  const first_open_number = button_status_array.indexOf('open');
  // イージーモードの場合：すでに選択されている数字から、3つ以内の数字をランダムで選択する
  if(difficulty == 'easy'){
    const com_choice = Math.floor(Math.random() * 3);
    for(let i = 1; i <= com_choice; i++){
      button_status_array[first_open_number + i] = "com";
      statusDisplayer(first_open_number + i)
    }
  }
  // ハードモードの場合：playerが必勝法を使う場合はランダム、使わない場合は必勝法を用いる
  else{
  function surefire_way(num){
    const gap = num - first_open_number + 1;
    if(gap <= 3){
      for(let i = 0; i < gap; i++){
        button_status_array[first_open_number + i] = 'com';
        statusDisplayer(first_open_number + i)
      }
    }else{
      const com_choice = Math.floor(Math.random() * 3);
      for(let i = 1; i <= com_choice; i++){
        button_status_array[first_open_number + i] = "com";
        statusDisplayer(first_open_number + i)
      }
    }
  }
  }

  if(first_open_number == 0){
    surefire_way(0);
  }else if(first_open_number <= 4){
    surefire_way(4);
  }else if(first_open_number <= 8){
    surefire_way(8);
  }else if(first_open_number <= 12){
    surefire_way(12);
  }else if(first_open_number <= 16){
    surefire_way(16);
  }else if(first_open_number <= 20){
    surefire_way(20);
  }else if(first_open_number <= 24){
    surefire_way(24);
  }else if(first_open_number <= 28){
    surefire_way(28);
  }else if(first_open_number == 29){
    surefire_way(29);
  }
}

// 状態にあわせた表示にする関数
function statusDisplayer(button_num){
  if(button_status_array[button_num - 1] == 'player'){
    $('#number' + i).css('background-color', 'lightskyblue');
    $('#number' + i).css('color', 'gray');
  }else if(button_status_array[button_num - 1] == 'tentative'){
    $('#number' + i).css('background-color', 'lightskyblue');
    $('#number' + i).css('color', 'gray');
  }else if(button_status_array[button_num - 1] == 'com'){
    $('#number' + i).css('background-color', 'pink');
    $('#number' + i).css('color', 'gray');
  }else{
    $('#number' + i).css('background-color', '');
    $('#number' + i).css('color', '');
  }
}

// リセットボタンを表示させる関数。勝敗の判定がされたときに、表示されるにようにする
function show_reset(){
  $('#play-again').text('もう一回？');
  $('#play-again').css('padding', '5px 10px');
  $('#play-again').css('border', 'solid 2px gray');
  $('#play-again').css('border-radius', '15px');
}


// 初期状態のターンの表示
player_turn = true; // デフォルトはplayer先攻
turn_change();

let button_num = 0; // 選択された数字
$('td.number').on('click', function(){
  // 選択された数字のidを取得
  button_num = $(this).attr('id');
  button_num = Number(button_num.substr(6));

  statusChanger(button_num);
  statusDisplayer(button_num);
  console.log(button_status_array);
})

$('#ok-btn').on('click', function(){
  if(button_status_array.indexOf('tentative') == -1){
      alert('数字を選択してください');
  }else if(button_status_array[(button_status_array.indexOf('open')) + 1] == 'tentative' || button_status_array[(button_status_array.indexOf('open')) + 2] == 'tentative'){
    alert('選択済みの数字に続く連番で選択してください');
  }else{
    for(let i = 0; i < button_status_array.length; i++){
      if(button_status_array[i] == 'tentative'){
        button_status_array.splice(i, 1, 'player');
      }
    }

    // comのターンに変更
    player_turn = false;
    turn_change();

    comSelector();

    // 勝敗の判定
    if(button_status_array[29] == 'com'){
      $('#result').text('あなたの勝ち!!');
      $('#result').css('color', 'red');
      show_reset();
    }else if(button_status_array[28] == 'com'){
      $('#result').text('あなたの負け...');
      $('#result').css('color', 'blue');
      button_status_array[29] == 'player';
      statusDisplayer(29);
      show_reset();
    }

    player_turn = true;
    turn_change();
  }
})

// リセットボタンのクリック
$('#play-again').on('click', function(){
  button_status_array = ['open', 'open', 'open', 'open', 'open', 'open', 'open', 'open', 'open', 'open', 'open', 'open', 'open', 'open', 'open', 'open', 'open', 'open', 'open', 'open', 'open', 'open', 'open', 'open', 'open', 'open', 'open', 'open', 'open', 'open'];
  statusDisplayer();

  $('#result').text('');
  $('#play-again').text('');
  $('#play-again').css('border', '');
})

</script>
</body>
</html>
